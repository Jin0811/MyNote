# Nginx

## 1 Nginx基本概念

<hr>

## 1.1 nginx是什么？能做什么事情？
Nginx是一个高性能的HTTP和反向代理web服务器，特点是占有内存小，并发能力强，事实上nginx的并发能力在同类型的网页服务器当中表现较好。

<hr>

## 1.2 反向代理
**正向代理**：Nginx不仅可以做反向代理，实现负载均衡，还能用作正向代理进行上网等功能，如果把局域网外的Internet想象成一个巨大的资源库，则局域网当中的客户端要访问Internet，则需要代理服务器进行访问，这种代理就称为正向代理

![正向代理图解](./images/正向代理.png)

**反向代理**：客户端对于代理是无感知的，因为客户端不需要任何配置就可以访问，我们只需要将请求发送到代理服务器，由代理服务器去选择目标服务器获取数据后，再返回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器的地址，隐藏了真实服务器的IP地址

![正向代理图解](./images/反向代理.png)

正向代理代理客户端，反向代理代理服务端


## 1.3 负载均衡
单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器的情况改成将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡

## 1.4 动静分离
为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析的速度，降低原来单个服务器的压力

![动静分离图解](./images/动静分离.png)

## 2 Nginx安装、常用命令和配置文件
- 在linux系统中安装nginx
- nginx常用命令（前提是要进入nginx目录下的sbin目录下）
  - 启动nginx：`cd [nginx/sbin]`，再`./nginx`
  - 查看nignx的进程：`ps -ef | grep nginx`
  - 查看防火墙开放的端口：`firewall-cmd --list-all`

  - 查看nginx版本号：`./nginx -v`
  - 启动nginx：`./nginx`
  - 关闭nginx：`./nginx -s stop`
  - 重新加载nginx配置：`./nginx -s reload`
  - 查看nginx的位置：`whereis nginx`
    
- nginx配置文件
  - 第一部分全局块：
    ```
    即从配置文件开始到events块之间的内容，主要会设置一些影响nginx服务器整体运行的配置指令，主要包括配置运行nginx服务器的用户（组）、允许生成的worker process数、进程PID存放路径、日志存放路径和类型以及配置文件的引入等
    ```
  - 第二部分events块：
    ```
    events块涉及的指令主要影响Nginx服务器与用户的网络连接，常用的设置包括是否开启对多worker_processes下的网络连接进行序列化、
    是否允许同时接受多个网络连接、选取哪种事件驱动模型来处理连接请求、每个worker_processes可以同时支持的最大连接数，
    这部分的配置对于Nginx的性能影响较大，在实际中应灵活配置
    ```
  - 第三部分http块：
    ```
    http块是配置最为繁琐的块，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里
    http块又包括http全局块和server块

    http全局块：文件引入、MIME-TYPE定义、连接超时时间、单链接请求数上限等等

    server块：这块和虚拟主机有密切关系，虚拟主机从用户角度来看，和一台独立的硬件主机是完全一样的，该技术的产生是为了节省服务器的硬件成本

    每个http块可以包含多个server块，而每个server块就相当于一个虚拟主机，而每个server块也分为全局server块，并且可以包含多个location块

    全局server块：最常见的配置是本虚拟机的监听配置和本虚拟机的IP配置

    location块：一个server块可以配置多个location块，这块的作用是基于nginx服务器接受到的字符串，例如server_name/urlString，对虚拟主机名称（也可以是IP别名）之外的字符串（例如前面的urlString）进行匹配，对特定的请求进行处理、地址定向、数据缓存和应答控制等功能，还有许多第三方的配置也在这里
    ```